<!doctype html>
<html lang="en-US">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<title>Test Runner</title>
<link type="text/css" rel="stylesheet" href="../css/style.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"
onload="renderMathInElement(document.body);"></script>
<script>
    // https://github.com/KaTeX/KaTeX/blob/main/docs/autorender.md
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            // customised options
            // auto-render specific keys, e.g.:
                delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true},
                {left: "\begin{equation}", right: "\end{equation}", display: true},
                {left: "\begin{align}", right: "\end{align}", display: true},
            ],
            // rendering keys, e.g.:
            throwOnError : false
        });
    });
 </script>

</head>
<body>
<main>

<p>
<nav class="crumbs">
</p>

<ul><li>
<p>
<a href="../index.html">ysg</a>
</p>
</li>
<li>
<p>
<a href="../sml/index.html">sml</a>
</p>
</li>
<li>
<p>
<a href="./index.html">xunit</a>
</p>
</li>
<li>
<p>
runner
</p>
</li>
</ul>

<p>
</nav>
</p>

<h1>Test Runner</h1>

<p>
Now we're nearing the finish line, we're almost done. 
</p>

<p>
The test runner is the "main" program.
</p>

<h2>Specification</h2>

<p>
It has a "big red button", just one, which is invoked to run the whole
thing: results are determined, reports tabulated, and then printed to
the screen (or written to a file, or posted to Tik Tok, or whatever).
</p>

<p>
Since this function is just waiting to be run, and produces
side-effects, it's a <code>unit -&gt; unit</code> function signature.
</p>

<pre data-lang="sml" class="src"><span class="k">signature</span> <span class="n">RUNNER</span> <span class="n">=</span> <span class="k">sig</span>
  <span class="k">val</span> <span class="n">run</span> <span class="n">:</span> <span class="n">unit</span> <span class="n">-&gt;</span> <span class="n">unit</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span></pre>

<h2>Parametrizing the Runner with a Reporter</h2>

<p>
We parametrize the test runner by some Reporter module. In Standard
ML, such structures parametrized by other structures are called
"functors" (no relation to "functors" in category theory).
</p>

<p>
The basic idea is that we will run all tests which have been
registered using <code>Test.register_suite</code>, then we will report the
results for all the tests, and then the program will exit (either
successfully or not depending on if there were only successful test
results or not, respectively).
</p>

<pre data-lang="sml" class="src"><span class="c">(*
Using any test reporter, we can run the tests, then
report the results.
*)</span>
<span class="k">functor</span> <span class="n">MkRunner</span><span class="p">(</span><span class="n">Reporter</span> <span class="n">:</span> <span class="n">REPORTER</span><span class="p">)</span> <span class="n">:&gt;</span> <span class="n">RUNNER</span> <span class="n">=</span> <span class="k">struct</span>
  <span class="k">fun</span> <span class="n">run</span> <span class="p">(</span><span class="p">)</span> <span class="n">=</span>
    <span class="k">let</span>
      <span class="k">val</span> <span class="n">results</span> <span class="n">=</span> <span class="n">Test</span>.<span class="n">run_all</span> <span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="k">in</span>
      <span class="n">Reporter</span>.<span class="n">report_all</span> <span class="n">results</span><span class="p">;</span>
      <span class="n">OS</span>.<span class="n">Process</span>.<span class="n">exit</span> <span class="p">(</span><span class="n">Test</span>.<span class="n">exit_status</span> <span class="n">results</span><span class="p">)</span><span class="p">;</span>
      <span class="p">(</span><span class="p">)</span>
    <span class="k">end</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span></pre>

<h2>Wrapping it all together</h2>

<p>
We will use the JUnit test reporter as the default reporter.
</p>

<p>
Working with MLton and Poly/ML, we also define the main function here
for future usage.
</p>

<pre data-lang="sml" class="src"><span class="c">(*

Using the different reporters, we can run the tests, then
report the results.

Defaults to the JUnitTt reporter.

For inspecting per test result, VerboseTt.report may be useful
*)</span>
<span class="k">structure</span> <span class="n">Runner</span> <span class="n">:&gt;</span> <span class="n">RUNNER</span> <span class="n">=</span> <span class="n">MkRunner</span><span class="p">(</span><span class="n">JUnitTt</span><span class="p">)</span><span class="p">;</span>

<span class="k">val</span> <span class="n">main</span> <span class="n">=</span> <span class="n">Runner</span>.<span class="n">run</span><span class="p">;</span></pre>

<p>
And we're done! Now we can use our lovely little testing library when
building other parts of our exploratory mission.
</p>

<p>
<footer>
</p>

<p>
<b>[</b>
<a href="./reporter.html">Back</a> <b>|</b> <a href="./index.html">Up</a>
<b>]</b>
</p>

<p>
</footer>
</p>

</main>

</body>
</html>
